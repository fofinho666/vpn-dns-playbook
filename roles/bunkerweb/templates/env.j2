MULTISITE=yes
SERVER_NAME={{ domain }} {{ authelia_subdomain }} {{ services | join(' ', attribute='subdomain') }}
USE_BUNKERNET=no
SERVE_FILES=no
DISABLE_DEFAULT_SERVER=yes
USE_MODSECURITY=no
AUTO_LETS_ENCRYPT=yes
USE_CLIENT_CACHE=yes
USE_GZIP=yes
USE_REVERSE_PROXY=yes
REVERSE_PROXY_URL_999=/authelia
ALLOWED_METHODS=GET|POST|PUT|HEAD|DELETE
USE_LIMIT_REQ=yes
LIMIT_REQ_RATE=40r/s
BLACKLIST_COUNTRY=cn ru
USE_BAD_BEHAVIOR=yes
BAD_BEHAVIOR_STATUS_CODES=400 401 403 404 405 444
BAD_BEHAVIOR_THRESHOLD=25
USE_REVERSE_PROXY=yes
USE_BLACKLIST=yes
BLACKLIST_IP=0.0.0.0/0
USE_WHITELIST=yes
WHITELIST_IP=192.168.0.0/16 {{ docker_network_ip_range }}
# Home
REVERSE_PROXY_URL=/
REVERSE_PROXY_HOST=http://homer:8080
REVERSE_PROXY_WS=yes
REVERSE_PROXY_INTERCEPT_ERRORS=no
# Authelia - 2fa Authentication
{{ authelia_subdomain }}_USE_BLACKLIST=no
{{ authelia_subdomain }}_REVERSE_PROXY_URL=/
{{ authelia_subdomain }}_REVERSE_PROXY_HOST=http://authelia:9091
{{ authelia_subdomain }}_REVERSE_PROXY_INTERCEPT_ERRORS=no
REVERSE_PROXY_URL_999=/authelia
REVERSE_PROXY_HOST_999=http://authelia:9091/api/verify
REVERSE_PROXY_HEADERS_999=X-Original-URL $scheme://$http_host$request_uri;Content-Length ""
# Services
{% for service in services %}
# {{ service.name }}
{{ service.subdomain }}_REVERSE_PROXY_URL=/
{{ service.subdomain }}_REVERSE_PROXY_HOST={{service.url}}
{{ service.subdomain }}_REVERSE_PROXY_INTERCEPT_ERRORS=no
{{ service.subdomain }}_COOKIE_FLAGS=* SameSite=Lax
{% if service.use_cors|default(false) %}
{{ service.subdomain }}_USE_CORS=yes
{% endif %}
{% if service.external|default(false) %}
{{ service.subdomain }}_USE_BLACKLIST=no
{{ service.subdomain }}_REVERSE_PROXY_AUTH_REQUEST=/authelia
{{ service.subdomain }}_REVERSE_PROXY_AUTH_REQUEST_SIGNIN_URL=https://{{ authelia_subdomain }}/?rd=$scheme%3A%2F%2F$host$request_uri
{{ service.subdomain }}_REVERSE_PROXY_AUTH_REQUEST_SET=$user $upstream_http_remote_user;$groups $upstream_http_remote_groups;$name $upstream_http_remote_name;$email $upstream_http_remote_email
{% endif %}
{% endfor %}
